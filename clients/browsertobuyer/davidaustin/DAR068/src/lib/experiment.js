import { trackGA4Event } from './helpers/utils';
import setup from './services/setup';
import shared from './shared/shared';

const { ID, VARIATION } = shared;

const trustPilotLogo = `<svg width="74" height="18" viewBox="0 0 74 18" fill="none" xmlns="http://www.w3.org/2000/svg">
  <g clip-path="url(#clip0_8249_9657)">
  <path d="M19.2617 6.37958H26.6829V7.7642H23.7649V15.5478H22.1603V7.7642H19.2552V6.37958H19.2617ZM26.3659 8.90942H27.7376V10.1905H27.7635C27.8087 10.0093 27.8929 9.83465 28.0158 9.66643C28.1387 9.4982 28.2875 9.33645 28.4622 9.20057C28.6369 9.05823 28.831 8.94824 29.0445 8.85766C29.2581 8.77354 29.478 8.72825 29.698 8.72825C29.8663 8.72825 29.9892 8.73472 30.0539 8.74119C30.1186 8.74766 30.1833 8.7606 30.2545 8.76707V10.1776C30.1509 10.1582 30.0474 10.1452 29.9374 10.1323C29.8274 10.1193 29.7239 10.1129 29.6204 10.1129C29.3745 10.1129 29.1416 10.1646 28.9216 10.2617C28.7016 10.3587 28.514 10.5075 28.3522 10.6952C28.1905 10.8893 28.0611 11.1222 27.964 11.4069C27.867 11.6916 27.8217 12.0151 27.8217 12.3839V15.5413H26.3594V8.90942H26.3659ZM36.977 15.5478H35.5406V14.6226H35.5147C35.3335 14.959 35.0683 15.2243 34.7124 15.4249C34.3566 15.6254 33.9942 15.729 33.6254 15.729C32.752 15.729 32.1179 15.5155 31.7297 15.082C31.3415 14.6485 31.1474 13.995 31.1474 13.1215V8.90942H32.6096V12.9792C32.6096 13.5615 32.7196 13.9756 32.9461 14.215C33.166 14.4543 33.4831 14.5773 33.8842 14.5773C34.1948 14.5773 34.4471 14.532 34.6542 14.4349C34.8612 14.3379 35.0295 14.215 35.1524 14.0532C35.2818 13.8979 35.3724 13.7038 35.4306 13.4838C35.4888 13.2638 35.5147 13.0244 35.5147 12.7656V8.91589H36.977V15.5478ZM39.468 13.4191C39.5133 13.8462 39.675 14.1438 39.9532 14.3185C40.2379 14.4867 40.5744 14.5773 40.9691 14.5773C41.1049 14.5773 41.2602 14.5643 41.4349 14.5449C41.6096 14.5255 41.7778 14.4802 41.9266 14.422C42.0819 14.3638 42.2049 14.2732 42.3084 14.1567C42.4054 14.0403 42.4507 13.8914 42.4443 13.7038C42.4378 13.5162 42.3666 13.3609 42.2372 13.2444C42.1078 13.1215 41.9461 13.0309 41.7455 12.9533C41.5449 12.8821 41.3185 12.8174 41.0596 12.7656C40.8008 12.7139 40.542 12.6556 40.2768 12.5974C40.005 12.5392 39.7397 12.4615 39.4874 12.3774C39.2351 12.2933 39.0086 12.1769 38.808 12.028C38.6075 11.8857 38.4457 11.6981 38.3292 11.4716C38.2063 11.2451 38.1481 10.9669 38.1481 10.6305C38.1481 10.2682 38.2387 9.97052 38.4133 9.72466C38.588 9.47879 38.8145 9.28469 39.0798 9.13587C39.3515 8.98706 39.6492 8.88354 39.9791 8.81884C40.3091 8.7606 40.6261 8.72825 40.9238 8.72825C41.2667 8.72825 41.5967 8.76707 41.9072 8.83825C42.2178 8.90942 42.5025 9.02588 42.7548 9.1941C43.0072 9.35586 43.2142 9.56937 43.3824 9.82818C43.5507 10.087 43.6542 10.404 43.6995 10.7728H42.1725C42.1013 10.4234 41.9461 10.184 41.6937 10.0676C41.4414 9.94464 41.1502 9.88641 40.8267 9.88641C40.7232 9.88641 40.6003 9.89288 40.4579 9.91229C40.3156 9.9317 40.1862 9.96405 40.0568 10.0093C39.9338 10.0546 39.8303 10.1258 39.7397 10.2164C39.6556 10.307 39.6103 10.4234 39.6103 10.5722C39.6103 10.7534 39.675 10.8958 39.798 11.0058C39.9209 11.1157 40.0826 11.2063 40.2832 11.284C40.4838 11.3551 40.7103 11.4198 40.9691 11.4716C41.2279 11.5234 41.4931 11.5816 41.7649 11.6398C42.0302 11.6981 42.289 11.7757 42.5478 11.8598C42.8066 11.9439 43.033 12.0604 43.2336 12.2092C43.4342 12.358 43.596 12.5392 43.7189 12.7592C43.8418 12.9792 43.9065 13.2574 43.9065 13.5809C43.9065 13.9756 43.8159 14.3055 43.6348 14.5838C43.4536 14.8555 43.2207 15.082 42.936 15.2502C42.6513 15.4184 42.3278 15.5478 41.9784 15.6254C41.629 15.7031 41.2796 15.7419 40.9367 15.7419C40.5162 15.7419 40.1279 15.6966 39.7721 15.5996C39.4162 15.5025 39.1057 15.3602 38.8468 15.1725C38.588 14.9784 38.381 14.739 38.2322 14.4543C38.0834 14.1697 38.0057 13.8267 37.9928 13.4321H39.468V13.4191ZM44.2947 8.90942H45.4011V6.91661H46.8634V8.90942H48.1833V10.0029H46.8634V13.5485C46.8634 13.7038 46.8699 13.8332 46.8828 13.9497C46.8957 14.0597 46.9281 14.1567 46.9734 14.2344C47.0187 14.312 47.0898 14.3702 47.1869 14.4091C47.2839 14.4479 47.4069 14.4673 47.5751 14.4673C47.6786 14.4673 47.7821 14.4673 47.8857 14.4608C47.9892 14.4543 48.0927 14.4414 48.1962 14.4155V15.5478C48.0345 15.5672 47.8727 15.5802 47.7239 15.5996C47.5686 15.619 47.4133 15.6254 47.2516 15.6254C46.8634 15.6254 46.5528 15.5866 46.3199 15.5155C46.087 15.4443 45.8993 15.3343 45.7699 15.1919C45.6341 15.0496 45.5499 14.8749 45.4982 14.6614C45.4529 14.4479 45.4205 14.202 45.4141 13.9303V10.0158H44.3077V8.90942H44.2947ZM49.2185 8.90942H50.6031V9.80877H50.629C50.8361 9.42056 51.1208 9.14881 51.4896 8.98059C51.8583 8.81236 52.253 8.72825 52.6865 8.72825C53.2106 8.72825 53.6635 8.81883 54.0517 9.00647C54.4399 9.18763 54.7635 9.43997 55.0223 9.76348C55.2811 10.087 55.4687 10.4623 55.5981 10.8893C55.7275 11.3163 55.7922 11.7757 55.7922 12.261C55.7922 12.7074 55.734 13.1409 55.6175 13.555C55.5011 13.9756 55.3264 14.3444 55.0934 14.6679C54.8605 14.9914 54.5629 15.2437 54.2006 15.4378C53.8382 15.6319 53.4177 15.729 52.9259 15.729C52.7124 15.729 52.4989 15.7096 52.2854 15.6707C52.0719 15.6319 51.8648 15.5672 51.6707 15.4831C51.4766 15.399 51.289 15.289 51.1272 15.1531C50.959 15.0173 50.8231 14.862 50.7067 14.6873H50.6808V18H49.2185V8.90942ZM54.33 12.2351C54.33 11.9375 54.2911 11.6463 54.2135 11.3616C54.1359 11.0769 54.0194 10.8311 53.8641 10.6111C53.7088 10.3911 53.5147 10.2164 53.2883 10.087C53.0553 9.95758 52.7901 9.88641 52.4924 9.88641C51.8778 9.88641 51.4119 10.0999 51.1013 10.527C50.7908 10.954 50.6355 11.5234 50.6355 12.2351C50.6355 12.5715 50.6743 12.8821 50.7584 13.1668C50.8425 13.4515 50.959 13.6973 51.1272 13.9044C51.289 14.1114 51.4831 14.2732 51.7095 14.3896C51.936 14.5126 52.2013 14.5708 52.4989 14.5708C52.8354 14.5708 53.1136 14.4996 53.3465 14.3638C53.5794 14.2279 53.767 14.0467 53.9159 13.8332C54.0647 13.6132 54.1747 13.3674 54.2394 13.0891C54.2976 12.8109 54.33 12.5262 54.33 12.2351ZM56.9116 6.37958H58.3738V7.7642H56.9116V6.37958ZM56.9116 8.90942H58.3738V15.5478H56.9116V8.90942ZM59.6808 6.37958H61.143V15.5478H59.6808V6.37958ZM65.6269 15.729C65.0963 15.729 64.624 15.6384 64.2099 15.4637C63.7958 15.289 63.4464 15.0431 63.1553 14.739C62.8706 14.4285 62.6506 14.0597 62.5018 13.6326C62.353 13.2056 62.2753 12.7333 62.2753 12.2221C62.2753 11.7175 62.353 11.2516 62.5018 10.8246C62.6506 10.3976 62.8706 10.0288 63.1553 9.71819C63.4399 9.40762 63.7958 9.16822 64.2099 8.99353C64.624 8.81883 65.0963 8.72825 65.6269 8.72825C66.1574 8.72825 66.6297 8.81883 67.0438 8.99353C67.4579 9.16822 67.8073 9.41409 68.0985 9.71819C68.3832 10.0288 68.6031 10.3976 68.752 10.8246C68.9008 11.2516 68.9784 11.7175 68.9784 12.2221C68.9784 12.7333 68.9008 13.2056 68.752 13.6326C68.6031 14.0597 68.3832 14.4285 68.0985 14.739C67.8138 15.0496 67.4579 15.289 67.0438 15.4637C66.6297 15.6384 66.1574 15.729 65.6269 15.729ZM65.6269 14.5708C65.9504 14.5708 66.2351 14.4996 66.4745 14.3638C66.7139 14.2279 66.908 14.0467 67.0632 13.8267C67.2185 13.6068 67.3285 13.3544 67.4062 13.0762C67.4773 12.798 67.5162 12.5133 67.5162 12.2221C67.5162 11.9375 67.4773 11.6592 67.4062 11.3746C67.335 11.0899 67.2185 10.844 67.0632 10.624C66.908 10.404 66.7139 10.2293 66.4745 10.0935C66.2351 9.95758 65.9504 9.88641 65.6269 9.88641C65.3034 9.88641 65.0187 9.95758 64.7793 10.0935C64.5399 10.2293 64.3458 10.4105 64.1905 10.624C64.0352 10.844 63.9252 11.0899 63.8476 11.3746C63.7764 11.6592 63.7376 11.9375 63.7376 12.2221C63.7376 12.5133 63.7764 12.798 63.8476 13.0762C63.9187 13.3544 64.0352 13.6068 64.1905 13.8267C64.3458 14.0467 64.5399 14.2279 64.7793 14.3638C65.0187 14.5061 65.3034 14.5708 65.6269 14.5708ZM69.4054 8.90942H70.5118V6.91661H71.9741V8.90942H73.294V10.0029H71.9741V13.5485C71.9741 13.7038 71.9806 13.8332 71.9935 13.9497C72.0064 14.0597 72.0388 14.1567 72.0841 14.2344C72.1294 14.312 72.2006 14.3702 72.2976 14.4091C72.3947 14.4479 72.5176 14.4673 72.6858 14.4673C72.7893 14.4673 72.8929 14.4673 72.9964 14.4608C73.0999 14.4543 73.2034 14.4414 73.3069 14.4155V15.5478C73.1452 15.5672 72.9834 15.5802 72.8346 15.5996C72.6793 15.619 72.5241 15.6254 72.3623 15.6254C71.9741 15.6254 71.6635 15.5866 71.4306 15.5155C71.1977 15.4443 71.01 15.3343 70.8806 15.1919C70.7448 15.0496 70.6607 14.8749 70.6089 14.6614C70.5636 14.4479 70.5312 14.202 70.5248 13.9303V10.0158H69.4184V8.90942H69.4054Z" fill="white"/>
  <path d="M17.5536 6.37958H10.8505L8.78001 0L6.70309 6.37958L0 6.37311L5.42847 10.3199L3.35155 16.693L8.78001 12.7527L14.202 16.693L12.1316 10.3199L17.5536 6.37958Z" fill="#00B67A"/>
  <path d="M12.5974 11.7628L12.1316 10.3199L8.78003 12.7527L12.5974 11.7628Z" fill="#005128"/>
  </g>
  <defs>
  <clipPath id="clip0_8249_9657">
  <rect width="73.294" height="18" fill="white"/>
  </clipPath>
  </defs>
</svg>
`;

const trustPilotStars = `<svg width="87" height="18" viewBox="0 0 87 18" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M16.4191 0.937499H0.294067V17.0625H16.4191V0.937499Z" fill="#00B67A"/>
  <path d="M33.8878 0.937499H17.7628V17.0625H33.8878V0.937499Z" fill="#00B67A"/>
  <path d="M51.3566 0.937499H35.2316V17.0625H51.3566V0.937499Z" fill="#00B67A"/>
  <path d="M68.8253 0.937499H52.7003V17.0625H68.8253V0.937499Z" fill="#00B67A"/>
  <path d="M86.2941 17.0625V0.937499H78.2316H70.1691V17.0625H78.2316H86.2941Z" fill="#00B67A"/>
  <path d="M8.35658 11.8051L10.8089 11.1836L11.8335 14.3414L8.35658 11.8051ZM14.0003 7.72344H9.68353L8.35658 3.65859L7.02963 7.72344H2.71283L6.20658 10.243L4.87963 14.3078L8.37338 11.7883L10.5234 10.243L14.0003 7.72344Z" fill="white"/>
  <path d="M25.8253 11.8051L28.2777 11.1836L29.3023 14.3414L25.8253 11.8051ZM31.4691 7.72342H27.1523L25.8253 3.65857L24.4984 7.72342H20.1816L23.6753 10.2429L22.3484 14.3078L25.8421 11.7883L27.9921 10.2429L31.4691 7.72342Z" fill="white"/>
  <path d="M43.2941 11.8051L45.7464 11.1836L46.771 14.3414L43.2941 11.8051ZM48.9378 7.72344H44.621L43.2941 3.65859L41.9671 7.72344H37.6503L41.1441 10.243L39.8171 14.3078L43.3109 11.7883L45.4609 10.243L48.9378 7.72344Z" fill="white"/>
  <path d="M60.7628 11.8051L63.2152 11.1836L64.2398 14.3414L60.7628 11.8051ZM66.4066 7.72344H62.0898L60.7628 3.65859L59.4359 7.72344H55.1191L58.6128 10.243L57.2859 14.3078L60.7796 11.7883L62.9296 10.243L66.4066 7.72344Z" fill="white"/>
  <path d="M78.2316 11.8051L80.6839 11.1836L81.7085 14.3414L78.2316 11.8051ZM83.8753 7.72344H79.5585L78.2316 3.65859L76.9046 7.72344H72.5878L76.0816 10.243L74.7546 14.3078L78.2484 11.7883L80.3984 10.243L83.8753 7.72344Z" fill="white"/>
</svg>
`;

const init = () => {
  const attachPoint = document.querySelector('header search-modal > .color-green').firstChild;

  const trustPilotHtml = `<div class="${ID}__tpContainer">
    <span class="${ID}__tpLogo">${trustPilotLogo}</span>
    <span class="${ID}__tpStars">${trustPilotStars}</span>
    <div class="${ID}__tpRatedText">Rated excellent</div>
    <div class="${ID}__divider">|</div>
    <div class="${ID}__tpReviewsText">4,200+ reviews</div>
  </div>`;

  if (!document.querySelector(`.${ID}__tpContainer`)) {
    attachPoint.insertAdjacentHTML('afterend', trustPilotHtml);
  }
};

export default () => {
  setup();

  if (VARIATION === 'control') return;

  if (VARIATION === '2') {
    document.body.addEventListener('click', (e) => {
      const { target } = e;

      if (target.closest(`.${ID}__tpContainer`)) {
        const action = 'Trustpilot Link Clicks';
        const eventCategory = 'DAR 068';
        trackGA4Event(eventCategory, action, '');
        window.location.href = 'https://uk.trustpilot.com/review/davidaustinroses.co.uk';
      }
    });
  }

  init();
};
